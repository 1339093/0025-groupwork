<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CASA0025 Final Assessment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">CASA0025 Final Assessment</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#analysis-of-the-evolution-of-urban-land-cover-and-environmental-change-in-shenzhen" id="toc-analysis-of-the-evolution-of-urban-land-cover-and-environmental-change-in-shenzhen" class="nav-link active" data-scroll-target="#analysis-of-the-evolution-of-urban-land-cover-and-environmental-change-in-shenzhen">Analysis of the evolution of urban land cover and environmental change in Shenzhen</a>
  <ul class="collapse">
  <li><a href="#project-summary" id="toc-project-summary" class="nav-link" data-scroll-target="#project-summary">1 Project Summary</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">2 Introduction</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">2.1 Background</a></li>
  <li><a href="#literature-review" id="toc-literature-review" class="nav-link" data-scroll-target="#literature-review">2.2 Literature review</a></li>
  </ul></li>
  <li><a href="#problem-statement" id="toc-problem-statement" class="nav-link" data-scroll-target="#problem-statement">3 Problem Statement</a></li>
  <li><a href="#end-user" id="toc-end-user" class="nav-link" data-scroll-target="#end-user">4 End User</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">5 Data</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">6 Methodology</a></li>
  <li><a href="#google-earth-engine-application" id="toc-google-earth-engine-application" class="nav-link" data-scroll-target="#google-earth-engine-application">7 Google Earth Engine Application</a>
  <ul class="collapse">
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing">Data pre-processing</a></li>
  <li><a href="#surface-cover-classification-and-area-statistics" id="toc-surface-cover-classification-and-area-statistics" class="nav-link" data-scroll-target="#surface-cover-classification-and-area-statistics">7.2 Surface Cover Classification and Area Statistics</a></li>
  </ul></li>
  <li><a href="#interaction-design" id="toc-interaction-design" class="nav-link" data-scroll-target="#interaction-design">8 Interaction Design</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">9 Limitations</a></li>
  <li><a href="#future-work" id="toc-future-work" class="nav-link" data-scroll-target="#future-work">10 Future work</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">11 Reference</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">




<section id="analysis-of-the-evolution-of-urban-land-cover-and-environmental-change-in-shenzhen" class="level1 page-columns page-full">
<h1>Analysis of the evolution of urban land cover and environmental change in Shenzhen</h1>
<p><strong>AUTHOR</strong><br>
.. Group</p>
<section id="project-summary" class="level2">
<h2 class="anchored" data-anchor-id="project-summary">1 Project Summary</h2>
<p>This project investigates the ecological impacts of rapid urbanization in Shenzhen by leveraging multi-source remote sensing data and geospatial analysis on the Google Earth Engine platform. Through the integration of spectral indices such as NDBBI, EVI, MNDWI, BSI, and land surface temperature (LST), combined with land cover classification and time-series analysis at both monthly and annual scales, the study captures spatial patterns and temporal trends of key surface changes. In addition, nighttime light intensity and NO₂ concentration data are incorporated to assess the relationship between urban expansion, human activities, and environmental quality. The results provide dynamic, multi-dimensional evidence to support sustainable urban planning and ecological management.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">2 Introduction</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">2.1 Background</h3>
<p>Shenzhen, located in the Pearl River Delta region of southern China, has experienced rapid urbanization and economic transformation over the past few decades, evolving from a small fishing village into a major global metropolis. While this urban growth has generated significant economic prosperity, it has also led to substantial environmental challenges, including intensified urban heat island effects, declining vegetation cover, water quality degradation, and increased air pollution. Understanding and addressing these ecological impacts are essential for promoting sustainable urban development and safeguarding the quality of life for residents.</p>
</section>
<section id="literature-review" class="level3">
<h3 class="anchored" data-anchor-id="literature-review">2.2 Literature review</h3>
<p>Urbanization significantly alters land surface characteristics, influencing local climate, hydrology, and biodiversity (Seto et al., 2012; Grimm et al., 2008). Urban expansion has been strongly linked to intensified urban heat island effects, with vegetation playing a crucial role in regulating urban microclimates (Zhou et al., 2017). The Enhanced Vegetation Index (EVI) has proven effective for assessing vegetation health and ecological conditions in urban environments (Huete et al., 2002).</p>
<p>Urban growth often leads to the loss of permeable surfaces, increased surface runoff, and degradation of water quality, challenges that can be effectively monitored through indices such as the Modified Normalized Difference Water Index (MNDWI) (Xu, 2006). Similarly, the Normalized Difference Built-up Index (NDBBI) and the Bare Soil Index (BSI) offer quantitative means to characterize urban development and its ecological impacts (Zha et al., 2003).</p>
<p>Nighttime light imagery has emerged as a valuable proxy for urbanization intensity and human activities, correlating with patterns of energy consumption and environmental stress (Elvidge et al., 2013). The increasing availability of long-term satellite observations, particularly from Landsat and MODIS platforms, has further facilitated the analysis of urban ecological dynamics over time (Weng et al., 2014).Recent advances in time-series remote sensing analysis have enabled more detailed tracking of urban ecological changes across different temporal scales, facilitating the identification of seasonal and interannual patterns (Zhu &amp; Woodcock, 2014).</p>
<p>Furthermore, urban land expansion has been associated with rising levels of atmospheric pollutants, such as NO₂, especially in rapidly developing metropolitan areas (Zheng et al., 2018). The integration of remote sensing data with machine learning algorithms, such as Random Forest classifiers, has significantly enhanced the accuracy and scalability of urban land cover mapping (Belgiu &amp; Drăguţ, 2016).</p>
</section>
</section>
<section id="problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="problem-statement">3 Problem Statement</h2>
<p>How does urbanization impact Shenzhen’s surface and environmental conditions over time?</p>
<p>Objective: To build an interactive monitoring and analysis platform that utilizes high-resolution, multi-temporal remote sensing datasets through the Google Earth Engine platform. By integrating indices such as NDBBI, EVI, BSI, MNDWI, and LST with machine learning-based land cover classification, the project identifies spatial patterns and temporal trends of key ecological indicators. It further quantifies the relationships between urban expansion and environmental variables—such as vegetation degradation, surface warming, water body shrinkage, nighttime light intensification, and NO₂ concentration changes—providing dynamic, multi-scale evidence to support sustainable urban planning and environmental management.</p>
</section>
<section id="end-user" class="level2">
<h2 class="anchored" data-anchor-id="end-user">4 End User</h2>
<p>Urban planners, environmental agencies, and local policymakers in Shenzhen</p>
<p>This application is designed to support urban planning departments and ecological management agencies by providing accurate, timely, and spatially-explicit data on the ecological effects of urbanization. By visualizing key indicators such as vegetation coverage (EVI), land surface temperature (LST), and impervious surface extent (NDBBI), the platform helps stakeholders monitor ecological changes, identify vulnerable areas, and evaluate the effectiveness of urban greening or mitigation strategies. The insights also empower policy decisions related to sustainable development, land-use regulation, climate adaptation, and public health interventions in rapidly urbanizing areas.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">5 Data</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 32%">
<col style="width: 35%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Data Type</strong></th>
<th style="text-align: left;"><strong>Dataset &amp; Source</strong></th>
<th style="text-align: left;"><strong>Usage</strong></th>
<th style="text-align: left;"><strong>Time Period</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Surface Reflectance &amp; Surface Temperature</strong></td>
<td style="text-align: left;"><code>LANDSAT/LC08/C02/T1_L2</code> – USGS Landsat 8 Collection 2 Tier 1 Level 2</td>
<td style="text-align: left;">Calculation of spectral indices (EVI, NDBBI, BSI, MNDWI) and land surface temperature (LST); used for classification and temporal analysis</td>
<td style="text-align: left;">2013–2023 (Classification focused on 2020)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Digital Elevation Model &amp; Terrain Attributes</strong></td>
<td style="text-align: left;"><code>USGS/SRTMGL1_003</code> – NASA SRTM DEM (30 m)</td>
<td style="text-align: left;">Extraction of slope and aspect for topographic correction of EVI</td>
<td style="text-align: left;">Static (Global DEM)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nighttime Lights</strong></td>
<td style="text-align: left;"><code>NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG</code> – VIIRS Monthly DNB</td>
<td style="text-align: left;">Monitoring of urban activity intensity and temporal urbanization trends</td>
<td style="text-align: left;">2013–2023</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Tropospheric NO₂ Concentration</strong></td>
<td style="text-align: left;"><code>COPERNICUS/S5P/OFFL/L3_NO2</code> – Sentinel-5P TROPOMI</td>
<td style="text-align: left;">Assessment of urban-related atmospheric pollution</td>
<td style="text-align: left;">2018–2023</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Administrative Boundaries</strong></td>
<td style="text-align: left;"><code>FAO/GAUL_SIMPLIFIED_500m/2015/level2</code> – FAO GAUL Level 2</td>
<td style="text-align: left;">Definition of region of interest (Shenzhen) for spatial analysis</td>
<td style="text-align: left;">Static (Snapshot in 2015)</td>
</tr>
</tbody>
</table>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">6 Methodology</h2>
<p>Flow chart</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
  A["Data Acquisition"]
  B["Preprocessing (SR &amp; LST Calibration)"]
  B1["Cloud Masking (maskL8sr)"]
  C["Spectral Index Calculation (EVI, NDBBI, MNDWI, BSI)"]
  D["Terrain Correction (only for EVI)"]

  E["Land Cover Classification:
  - Built-up
  - 4 Vegetation levels
  - Water
  - Other"]

  V["Validation Sample Collection
  (Stratified random sampling)"]

  F1["Monthly Time-Series Analysis"]
  F2["Annual Trend Analysis (2013-2023)"]

  G1["Monthly Metrics:
  - EVI/NDBBI/LST
  - Nighttime Lights
  - NO₂ (post-2018)"]
  
  G2["Annual Metrics:
  - Built-up growth rate
  - Vegetation loss
  - LST trends
  - NO₂ correlation"]

  ACC["Accuracy Validation:
  - OA=94.2%
  - Kappa=0.911"]

  H["Statistical Analysis:
  - Area calculation
  - Change detection"]

  I["Correlation Analysis:
  - EVI vs NDBBI
  - LST vs Built-up
  - NO₂ vs Urbanization"]

  J["Interactive Visualization:
  - Year slider control
  - 3 analysis panels
  - Dynamic charts
  - Legend display"]

  A --&gt; B
  B --&gt; B1
  B1 --&gt; C
  C --&gt;|NDBBI/BSI/MNDWI| E
  C --&gt;|EVI| D --&gt; E
  E --&gt; V
  V --&gt; ACC
  E --&gt; F1
  E --&gt; F2
  F1 &lt;--&gt; F2
  F1 --&gt; G1
  F2 --&gt; G2
  G1 --&gt; H
  G2 --&gt; H
  H --&gt; I
  I --&gt; J
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>How are you using this data to address the problem?</p>
<p>By preprocessing multi-source remote sensing data and calculating key ecological indices (EVI, NDBBI, MNDWI, BSI, LST), we classify land cover types, track monthly and annual changes, and analyze the relationships between urban expansion, environmental degradation, and human activities. This integrated approach provides spatial-temporal evidence to understand and quantify the ecological impacts of Shenzhen’s rapid urbanization.</p>
</section>
<section id="google-earth-engine-application" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="google-earth-engine-application">7 Google Earth Engine Application</h2>
<div class="column-page">
<iframe src="https://folkloric-vault-452715-s9.projects.earthengine.app/view/casa0025" width="110%" height="700px">
</iframe>
</div>
<section id="data-pre-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-pre-processing">Data pre-processing</h3>
<p>In this project, Shenzhen City is taken as the study area, and the year 2020 is selected as an example to use multi-source remote sensing data for surface cover classification and change analysis. Firstly, the boundary of Shenzhen City was extracted from the FAO GAUL database and centred. Subsequently, Landsat 8 data preprocessing, including cloud masking, radiometric correction and cropping to the study area, was performed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> gaul <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">'FAO/GAUL_SIMPLIFIED_500m/2015/level2'</span>)<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi <span class="op">=</span> gaul<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'ADM2_NAME'</span><span class="op">,</span> <span class="st">'Shenzhen'</span>))<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(roi<span class="op">,</span> <span class="dv">11</span>)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Cloud masking and radiometric correction</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskL8sr</span>(image) {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'QA_PIXEL'</span>)<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> shadowBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(shadowBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> optical <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'SR_B.'</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0000275</span>)<span class="op">.</span><span class="fu">add</span>(<span class="op">-</span><span class="fl">0.2</span>)<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> thermal <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'ST_B.*'</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.00341802</span>)<span class="op">.</span><span class="fu">add</span>(<span class="fl">149.0</span>)<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(optical<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">addBands</span>(thermal<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">updateMask</span>(mask)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">clip</span>(roi)<span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="surface-cover-classification-and-area-statistics" class="level3">
<h3 class="anchored" data-anchor-id="surface-cover-classification-and-area-statistics">7.2 Surface Cover Classification and Area Statistics</h3>
<ul>
<li>Calculate a variety of environmental indices such as Enhanced Vegetation Index (EVI), Normalised Water Body Index (MNDWI), Urban Index (NDBBI), Bare Land Index (BSI), etc;</li>
<li>Setting thresholds to extract masks for different feature types, including built-up areas, different densities of vegetation, water bodies and other types;</li>
<li>Superimpose each mask to generate a single-band classification image (Land Cover Map) and visualise it according to preset colours;</li>
<li>Based on the classification results, the total area of each category and its percentage of the total area of the study area were calculated.</li>
</ul>
</section>
</section>
<section id="interaction-design" class="level2">
<h2 class="anchored" data-anchor-id="interaction-design">8 Interaction Design</h2>
<p>This project builds a dynamic, interactive application on the Google Earth Engine platform, with key features including.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Overview</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Monthly Analysis</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Yearly Trend Analysis</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Correlation Analysis</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">UI Enhancements</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>- Year Selection</strong><br>
Users can select any year (2013–2023) via a slider. Land cover classification, surface indices, and area statistics are updated dynamically, with a 5-second debounce to ensure stability.</p>
<p><strong>- Land Cover Classification and Accuracy Assessment</strong><br>
The app provides multilayer land cover maps (Built-up, Vegetation, Water, Other) and displays classification metrics, including Overall Accuracy and Kappa Coefficient.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<ul>
<li>Monthly Nighttime Light Intensity Chart</li>
<li>Monthly Land Surface Temperature (LST) Chart</li>
<li>Annual Land Cover Area Pie Chart</li>
<li>Vegetation Type Distribution Bar Chart</li>
</ul>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<ul>
<li>Annual Built-up Ratio vs LST Trend</li>
<li>Built-up Area vs Nighttime Light Intensity</li>
<li>Built-up Area vs Air Pollution (NO₂ concentration)</li>
<li>Land Cover Ratio Trends (2013–2024)</li>
</ul>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<ul>
<li>Scatter plots and trendlines for:
<ul>
<li>EVI vs NDBBI</li>
<li>NDBBI vs LST</li>
<li>LST vs EVI<br>
</li>
</ul></li>
<li>Real-time Pearson correlation coefficients are calculated and displayed.</li>
</ul>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<ul>
<li>Soft theme colors</li>
<li>Dynamic show/hide controls for each chart</li>
<li>Modular panels ensure a smooth</li>
<li>Intuitive user experience.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">9 Limitations</h2>
<p>While this project provides a comprehensive and dynamic exploration of urban ecological changes in Shenzhen, several limitations should be acknowledged.</p>
<p>First, the analysis is primarily based on remote sensing-derived indicators processed on the Google Earth Engine (GEE) platform. Although these indicators effectively capture surface conditions, they inevitably simplify complex ecological and socioeconomic processes. Spectral indices and land cover classifications, while quantitatively robust, may not fully reflect the functional diversity and fine-scale heterogeneity of urban ecosystems.</p>
<p>Second, the project focuses mainly on biophysical variables such as vegetation dynamics, water distribution, surface temperature, and built-up expansion. Broader socioeconomic factors—such as demographic shifts, policy interventions, and industrial restructuring—are not directly incorporated, which limits a holistic understanding of urbanization impacts.</p>
<p>Finally, the reliance on satellite-based observations introduces inherent temporal and spatial limitations, particularly in capturing rapid micro-scale changes in dense urban environments. The constraints of GEE’s cloud computing environment, including processing quotas, data resolution, and algorithm flexibility, may also affect the depth and customization of the analysis.</p>
</section>
<section id="future-work" class="level2">
<h2 class="anchored" data-anchor-id="future-work">10 Future work</h2>
<p>Building on the current framework, several directions could enhance the depth and breadth of future research.</p>
<p>First, integrating socioeconomic datasets—such as census data, land use planning records, and economic activity indicators—would allow a more comprehensive understanding of the drivers and consequences of urban ecological changes. Coupling remote sensing data with socioeconomic analysis could reveal more nuanced patterns of urbanization.</p>
<p>Second, improving spatial and temporal resolution is crucial. The use of higher-resolution imagery (e.g., Sentinel-2, commercial satellite data) or fusion methods could better capture fine-scale variations, particularly in highly heterogeneous urban cores. Incorporating more frequent observations would also enhance the reliability of time-series analysis, especially for detecting rapid or seasonal changes.</p>
<p>Last, expanding the analysis beyond surface conditions to include water quality metrics, or biodiversity indices could provide a fuller ecological profile. Integrating multiple environmental dimensions would move the assessment closer to ecosystem health evaluation rather than surface characterization alone.</p>
</section>
<section id="reference" class="level2">
<h2 class="anchored" data-anchor-id="reference">11 Reference</h2>
<p>Belgiu, M., &amp; Drăguţ, L. (2016). Random forest in remote sensing: A review of applications and future directions. ISPRS Journal of Photogrammetry and Remote Sensing, 114, 24–31. https://doi.org/10.1016/j.isprsjprs.2016.01.011</p>
<p>Elvidge, C. D., Baugh, K. E., Zhizhin, M., &amp; Hsu, F. C. (2013). Why VIIRS data are superior to DMSP for mapping nighttime lights. Proceedings of the Asia-Pacific Advanced Network, 35, 62–69. https://doi.org/10.7125/APAN.35.7</p>
<p>Grimm, N. B., Faeth, S. H., Golubiewski, N. E., Redman, C. L., Wu, J., Bai, X., &amp; Briggs, J. M. (2008). Global change and the ecology of cities. Science, 319(5864), 756–760. https://doi.org/10.1126/science.1150195</p>
<p>Huete, A. R., Didan, K., Miura, T., Rodriguez, E. P., Gao, X., &amp; Ferreira, L. G. (2002). Overview of the radiometric and biophysical performance of the MODIS vegetation indices. Remote Sensing of Environment, 83(1–2), 195–213. https://doi.org/10.1016/S0034-4257(02)00096-2</p>
<p>Liu, Y., Wang, S., &amp; Xue, J. (2020). Spatiotemporal patterns of NO₂ emissions and their relationship with urbanization in China. Science of the Total Environment, 728, 138919. https://doi.org/10.1016/j.scitotenv.2020.138919</p>
<p>Seto, K. C., Güneralp, B., &amp; Hutyra, L. R. (2012). Global forecasts of urban expansion to 2030 and direct impacts on biodiversity and carbon pools. Proceedings of the National Academy of Sciences, 109(40), 16083–16088. https://doi.org/10.1073/pnas.1211658109</p>
<p>Weng, Q., Lu, D., &amp; Schubring, J. (2004). Estimation of land surface temperature–vegetation abundance relationship for urban heat island studies. Remote Sensing of Environment, 89(4), 467–483. https://doi.org/10.1016/j.rse.2003.11.005</p>
<p>Xu, H. (2006). Modification of normalised difference water index (NDWI) to enhance open water features in remotely sensed imagery. International Journal of Remote Sensing, 27(14), 3025–3033. https://doi.org/10.1080/01431160600589179</p>
<p>Zha, Y., Gao, J., &amp; Ni, S. (2003). Use of normalized difference built-up index in automatically mapping urban areas from TM imagery. International Journal of Remote Sensing, 24(3), 583–594. https://doi.org/10.1080/01431160304987</p>
<p>Zheng, Y., Cheng, J., Yu, T., &amp; Shi, Q. (2018). Spatial relationship between NO₂ concentration and urban land use in a rapidly urbanizing region: A case study of the Pearl River Delta, China. Atmospheric Pollution Research, 9(3), 541–548. https://doi.org/10.1016/j.apr.2017.11.002</p>
<p>Zhou, D., Zhao, S., Liu, S., Zhang, L., &amp; Zhu, C. (2014). Surface urban heat island in China’s 32 major cities: Spatial patterns and drivers. Remote Sensing of Environment, 152, 51–61. https://doi.org/10.1016/j.rse.2014.05.017</p>
<p>Zhu, Z., &amp; Woodcock, C. E. (2014). Automated cloud, cloud shadow, and snow detection in multitemporal Landsat data: An algorithm designed specifically for monitoring land cover change. Remote Sensing of Environment, 152, 217–234. https://doi.org/10.1016/j.rse.2014.06.012</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024 Group Name</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 twitter
  </li>  
    <li class="nav-item">
 facebook
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>